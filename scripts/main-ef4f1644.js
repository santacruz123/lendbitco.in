!function(){"use strict";angular.module("lendbitcoin",["ngCookies","ui.router","percentage","xeditable"]).config(["$stateProvider","$urlRouterProvider",function(e,t){e.state("home",{url:"/",templateUrl:"app/main/main.html",controller:"MainCtrl"}).state("address",{url:"/{address:r[\\w]{33}}",templateUrl:"app/main/main.html",controller:"MainCtrl"}),t.otherwise("/")}]),angular.module("lendbitcoin").service("_",["$window",function(e){return e.window._}]),angular.module("lendbitcoin").service("RB",["$window",function(e){return e.window.rippleBonds}])}(),function(){"use strict";function e(e,t,r,n,o){o.isUndefined(t.address)||(n.acc=t.address),e.rb=r,e.setOrderTemplate=function(t,r){o.isUndefined(t.b)?o.isUndefined(t.t)&&(t.t=!1):(t.p="b"===r?t.b:t.a,t.t="b"===r),e.preset=t},e.preset={},e.predicate="b",e.reverse=!1,e.filter={}}e.$inject=["$scope","$stateParams","RB","Account","_"],angular.module("lendbitcoin").controller("MainCtrl",e)}(),function(){"use strict";angular.module("lendbitcoin").constant("FED","rQpCfAsbZFRwH53aoVqzKFcXuq6wnukQCL")}(),function(){"use strict";function e(e,t){return{templateUrl:"app/account/account.balance.directive.tpl.html",restrict:"E",controller:["$scope",function(r){e.updateBalances(),t.$on("balance:update",function(){r.balances=e.getBalances(),t.$apply()})}]}}e.$inject=["Platform","$rootScope"],angular.module("lendbitcoin").directive("accountBalance",e)}(),function(){"use strict";function e(e,t,r){return{templateUrl:"app/account/account.directive.tpl.html",restrict:"E",scope:{},controller:["$scope",function(n){n.$watch("user.acc",function(t,o){t!==o&&(e.acc=t,n.isSecretSet=!1,r.$broadcast("account:change"))}),n.setSecret=function(e){t.setSecret(e),n.user.secret="",n.isSecretSet=!0},n.user={acc:e.acc}}]}}e.$inject=["Account","Ripple","$rootScope"],angular.module("lendbitcoin").directive("account",e)}(),function(){"use strict";function e(e,t){var r="";this.__defineGetter__("acc",function(){return r||e.get("acc")}),this.__defineSetter__("acc",function(t){var n=t.match(/r[\w]{33}/);return n[0]?(r=n[0],e.put("acc",r),!0):!1}),this.addIssuer=function(r,n){var o=e.get("AddressBook");t.isUndefined()&&(o={}),o[r]=n,e.put("AddressBook",o)},this.removeIssuer=function(t){var r=e.get("AddressBook");delete r[t],e.put("AddressBook",r)},this.getAddressBook=function(){return e.get("AddressBook")},this.addFavBond=function(r){var n=e.get("Favs");n||(n={bonds:[]});var o=t.pick(r,["i","s"]);t.find(n.bonds,o)||n.bonds.push(o),e.put("Favs",n)},this.removeFavBond=function(r){var n=e.get("Favs");n.bonds=t.remove(n.bonds,t.pick(r,["i","s"])),e.put("Favs",n)},this.getFavBonds=function(){var t=e.get("Favs");return t?t.bonds:[]}}e.$inject=["$cookieStore","_"],angular.module("lendbitcoin").service("Account",e)}(),function(){"use strict";function e(e,t){return{templateUrl:"app/positions/positions.directive.tpl.html",restrict:"E",controller:["$scope",function(r){t.$on("balance:update",function(){r.positions=e.getPositions()})}]}}e.$inject=["Platform","$rootScope"],angular.module("lendbitcoin").directive("positions",e)}(),function(){"use strict";function e(e,t){return{templateUrl:"app/watchlist/watchlist.directive.tpl.html",restrict:"E",controller:["$scope",function(r){function n(){r.bonds=e.getBonds(),t.$apply()}t.$on("bond:update",n),t.$on("bond:new",n)}]}}e.$inject=["Platform","$rootScope"],angular.module("lendbitcoin").directive("watchlist",e)}(),angular.module("lendbitcoin").directive("orders",["Platform","$rootScope",function(e,t){return{templateUrl:"app/orders/orders.directive.tpl.html",restrict:"E",controller:["$scope",function(r){t.$on("order:update",function(){r.orders=e.getOrders(),t.$apply()}),e.updateOrders(),r.cancelOrder=function(t){e.cancelOrder(t).then(function(e){console.log("Success",e)},function(e){console.log("Error",e)})}}]}}]),angular.module("lendbitcoin").directive("bondsExpire",function(){return{template:"{{expMonth|date:dtFormat}} ({{daysLeft}} days)",restrict:"E",scope:{date:"@"},controller:["$scope",function(e){var t=new Date(e.date.replace(/"/g,""));e.expMonth=new Date(t.getTime()-1);var r=new Date,n=new Date(r.getTime()+60*r.getTimezoneOffset()*1e3);e.daysLeft=Math.round((t.getTime()-n)/24/60/60/1e3),e.dtFormat=e.daysLeft>=365?"MMM y":"MMM"}]}}),function(){"use strict";function e(e,t){return{template:'<a ng-click="toggleFav()">{{isFav}}</a>',restrict:"E",scope:{bond:"="},controller:["$scope",function(r){var n=e.getFavBonds(),o=t.pick(r.bond,["i","s"]);r.isFav=Boolean(t.find(n,o)),r.toggleFav=function(){r.isFav?e.removeFavBond(o):e.addFavBond(o),r.isFav=!r.isFav}}]}}e.$inject=["Account","_"],angular.module("lendbitcoin").directive("bondsFavourite",e)}(),function(){"use strict";function e(e,t){return{templateUrl:"app/platform/platform.buysell.directive.tpl.html",restrict:"E",scope:!1,controller:["$scope",function(r){r.$watch("preset",function(e){r.order=angular.copy(e),r.order.t=String(r.order.t)},!0),t.$on("bond:new",function(){r.issuers=e.getIssuers()}),r.makeOrder=function(){var t={i:r.order.i,s:r.order.s,t:Boolean(+r.order.t),v:+r.order.v,p:+r.order.p};e.makeOrder(t).then(function(e){console.log("Error",e)},function(e){console.log("Success",e)})}}]}}e.$inject=["Platform","$rootScope"],angular.module("lendbitcoin").directive("buysell",e)}(),function(){"use strict";function e(e){return{templateUrl:"app/platform/platform.symbol.add.directive.tpl.html",restrict:"E",scope:!1,controller:["$scope",function(t){t.addSymbol=function(){if(angular.isDefined(t.symbol.str)){var r=t.symbol.str.split(":");e.addSymbol({i:r[0],s:r[1].toUpperCase()})}else t.symbol.s.toUpperCase(),e.addSymbol(t.symbol)}}]}}e.$inject=["Platform"],angular.module("lendbitcoin").directive("platformSymbolAdd",e)}(),function(){"use strict";function e(e,t,r,n,o,i,c){function a(e,t){b=t,i.$broadcast("order:update")}function s(e,t){u(t),i.$broadcast("bond:update")}function d(e,t){n(t).forEach(u),i.$broadcast("balance:update")}function u(e){if(!e.i||!e.s||"XRP"===e.s)return console.log("updateSymbol - Invalid symbol supplied",e),!1;var t=n.findIndex(f,function(t){return!(e.i!==t.i||e.s!==t.s)});if(-1!==t)n.assign(f[t],e),console.log("Updating",e);else{var c=o.isSymbol(e.s),a=o.isCurrency(e.s);if(!c&&!a)return void console.log("updateSymbol - new - Invalid symbol supplied");var s={v:0,b:0,a:0};c&&(s.e=o.getExpDate(e.s),r.watchBidAsk(e)),n.defaults(e,s),f.push(e),i.$broadcast("bond:new")}}function l(e){a(null,n.reject(b,{id:e}))}var p=this,f=[],b=[];i.$on("bond:price",s),i.$on("order:change",a),i.$on("balance:change",d),i.$on("account:change",function(){f=[],r.getBalances(),r.updateOrders()}),angular.forEach(o.currencies,function(t){u({i:e,s:t})}),angular.forEach(t.getFavBonds(),u),this.addSymbol=u,this.getIssuers=function(){return n(f).map("i").uniq().value()},this.updateBalances=r.getBalances,this.updateOrders=r.updateOrders,this.getBalances=function(){return n(f).filter(function(t){return t.i===e&&0!==t.v&&o.isCurrency(t.s)}).value()},this.getBonds=function(){return n(f).filter("e").value()},this.getPositions=function(){return n(f).filter("v").filter("e").value()},this.getOrders=function(){return b},this.makeOrder=function(n){var i=c.defer();if(!r.isSecretSet())return console.error("Set secret"),c.reject(new Error("Set secret"));var a=r.transaction(),s=o.currencyCodes[n.s[0]],d=(n.v*n.p).toFixed(4)+"/"+s+"/"+e,u=n.v.toFixed(4)+"/"+n.s+"/"+n.i,l=n.t?{from:t.acc,expiration:n.e,flag:n.f,buy:u,sell:d}:{from:t.acc,expiration:n.e,flag:n.f,buy:d,sell:u};return a.offerCreate(l),a.submit(function(e,t){return e?i.reject(e):"tesSUCCESS"!==t.engine_result?i.reject(t):(p.updateOrders(),console.log("makeOrder",t.tx_json.Sequence),i.resolve(t.tx_json.Sequence))}),i},this.cancelOrders=function(e){return c.all(n(b).filter(e).pluck("id").value().map(p.cancelOrder))},this.cancelOrder=function(e){console.log("Cancelling order",e);var n=c.defer();if(!r.isSecretSet())return console.error("Set secret"),c.reject(new Error("Set secret"));var o=r.transaction().offerCancel(t.acc,e);return o.submit(function(t,r){return t?n.reject(t):"tesSUCCESS"!==r.engine_result?n.reject(r):(l(e),console.log("cancelOrder",e),n.resolve(e))}),n}}e.$inject=["FED","Account","Ripple","_","RB","$rootScope","$q"],angular.module("lendbitcoin").service("Platform",e)}(),function(){"use strict";function e(e,t,r,n,o,i){var c,a=e.window.ripple,s=a.Remote,d=new s({trusted:!0,local_signing:!0,local_fee:!0,fee_cushion:1.5,servers:[{host:"s-east.ripple.com",port:443,secure:!0},{host:"s-west.ripple.com",port:443,secure:!0}]});d.connect(),this.setSecret=function(e){d.set_secret(r.acc,e),c=!0},this.isSecretSet=function(){return c},this.watchBidAsk=function(e){function r(e,t){return"bid"===t?"undefined"==typeof e.TakerGets.issuer?(e.TakerGets/e.TakerPays.value/1e6).toFixed(3):(e.TakerGets.value/e.TakerPays.value).toFixed(3):"undefined"==typeof e.TakerPays.issuer?(e.TakerPays/e.TakerGets.value/1e6).toFixed(3):(e.TakerPays.value/e.TakerGets.value).toFixed(3)}function n(e){var t="bid"===e?{issuer_pays:l.issuer,currency_pays:l.currency,issuer_gets:p.issuer,currency_gets:p.currency}:{issuer_pays:p.issuer,currency_pays:p.currency,issuer_gets:l.issuer,currency_gets:l.currency};c(e);var r=d.book(t);r.on("transaction",function(){c(e)})}function c(e){var t="bid"===e?{gets:p,pays:l}:{gets:l,pays:p};d.requestBookOffers(t,a(e))}function a(e){return function(t,n){if(!t){var o="undefined"!=typeof n.offers[0]?r(n.offers[0],e):0,c="bid"===e?{i:s,s:u,b:+(+o).toFixed(4)}:{i:s,s:u,a:+(+o).toFixed(4)};i.$broadcast("bond:price",c)}}}var s=e.i,u=e.s,l={currency:u,issuer:s},p={currency:o.currencyCodes[u[0]],issuer:t};angular.forEach(["bid","ask"],n)},this.getBalances=function(){d.request_account_lines(r.acc,function(e,t){if(e)return void console.log("request_account_lines error - ",e);var r=n(t.lines).filter(function(e){return o.isSymbol(e.currency)||n.indexOf(o.currencies,e.currency)>-1}).map(function(e){return{i:e.account,s:e.currency,v:+(+e.balance).toFixed(3)}}).value();i.$broadcast("balance:change",r)})},this.transaction=function(){return d.transaction()},this.Amount=a.Amount,this.updateOrders=function(){function e(e){var r,n;return r=e.taker_gets,n=e.taker_pays,r.issuer===t&&o.isCurrency(r.currency)&&o.isSymbol(n.currency)||n.issuer===t&&o.isCurrency(n.currency)&&o.isSymbol(r.currency)}d.requestAccountOffers(r.acc,function(t,r){if(t)return void console.log("Ripple - updating orders failed",t);var c=n(r.offers).filter(e).map(function(e){var t={},r=e.taker_gets,n=e.taker_pays;return t.id=e.seq,t.t=o.isCurrency(r.currency),t.i=t.t?n.issuer:r.issuer,t.s=t.t?n.currency:r.currency,t.p=t.t?+r.value/+n.value:+n.value/+r.value,t.p=+t.p.toFixed(4),t.v=t.t?+n.value:+r.value,t.v=+t.v.toFixed(4),t}).value();console.log("Orders",c),i.$broadcast("order:change",c)})}}e.$inject=["$window","FED","Account","_","RB","$rootScope"],angular.module("lendbitcoin").service("Ripple",e)}(),function(e){try{e=angular.module("lendbitcoin")}catch(t){e=angular.module("lendbitcoin",[])}e.run(["$templateCache",function(e){e.put("app/account/account.balance.directive.tpl.html",'<div ng-hide="balances">Zero balance</div><span ng-repeat="curr in balances"><strong>{{curr.s}}</strong>: {{curr.v|number:2}}</span>')}])}(),function(e){try{e=angular.module("lendbitcoin")}catch(t){e=angular.module("lendbitcoin",[])}e.run(["$templateCache",function(e){e.put("app/account/account.directive.tpl.html",'<div class="col-md-6">Account: <a href="#" editable-text="user.acc">{{ user.acc || \'Your ripple address here...\' }}</a></div><div class="col-md-6" ng-if="!isSecretSet">Password : <input type="text" ng-model="user.secret"> <button ng-click="setSecret(user.secret)">Set secret</button></div>')}])}(),function(e){try{e=angular.module("lendbitcoin")}catch(t){e=angular.module("lendbitcoin",[])}e.run(["$templateCache",function(e){e.put("app/main/main.html",'<div class="container-fluid"><div class="pull-left"><div><account-balance></account-balance></div></div><div class="pull-right"><account></account></div></div><div class="container-fluid"><div class="pull-right"><div><platform-symbol-add></platform-symbol-add></div><div id="tradetab"><buysell preset="preset"></buysell></div><div id="positions"><positions></positions></div><div id="orders"><orders cb="reloadCb"></orders></div></div><div><watchlist></watchlist></div></div>')}])}(),function(e){try{e=angular.module("lendbitcoin")}catch(t){e=angular.module("lendbitcoin",[])}e.run(["$templateCache",function(e){e.put("app/orders/orders.directive.tpl.html",'Orders:<table><thead><tr><th>Id</th><th>Issuer</th><th>Symbol</th><th>Type</th><th>Price</th><th>Size</th></tr></thead><tbody><tr ng-repeat="order in orders" ng-click="setOrderTemplate(order)"><td ng-dblclick="cancelOrder(order.id)">{{order.id}}</td><td>{{order.i}}</td><td>{{order.s}}</td><td>{{order.t ? \'buy\' : \'sell\'}}</td><td>{{order.p}}</td><td>{{order.v}}</td></tr></tbody></table>')}])}(),function(e){try{e=angular.module("lendbitcoin")}catch(t){e=angular.module("lendbitcoin",[])}e.run(["$templateCache",function(e){e.put("app/platform/platform.buysell.directive.tpl.html",'<div><select ng-model="order.i" ng-options="i as i for i in issuers"></select><br>Symbol: <input type="text" ng-model="order.s"><br>Type: BUY <input type="radio" ng-model="order.t" value="1"> SELL <input type="radio" ng-model="order.t" value="0"><br>Size: <input type="text" ng-model="order.v"><br>Price: <input type="text" ng-model="order.p"><br><button ng-click="makeOrder()">Send order</button></div>')}])}(),function(e){try{e=angular.module("lendbitcoin")}catch(t){e=angular.module("lendbitcoin",[])}e.run(["$templateCache",function(e){e.put("app/platform/platform.symbol.add.directive.tpl.html",'<div><select ng-model="symbol.i" ng-options="i as i for i in issuers"></select><br>Symbol: <input type="text" ng-model="symbol.s"><br>OR<br>Issuer:symbol : <input type="text" ng-model="symbol.str"><br><button ng-click="addSymbol()">Add symbol</button></div>')}])}(),function(e){try{e=angular.module("lendbitcoin")}catch(t){e=angular.module("lendbitcoin",[])}e.run(["$templateCache",function(e){e.put("app/positions/positions.directive.tpl.html",'Positions:<table><thead><tr><th>Issuer</th><th>Symbol</th><th>Size</th></tr></thead><tbody><tr ng-repeat="row in positions" ng-click="setOrderTemplate(row)"><td>{{row.i}}</td><td>{{row.s}}</td><td>{{row.v}}</td></tr></tbody></table>')}])}(),function(e){try{e=angular.module("lendbitcoin")}catch(t){e=angular.module("lendbitcoin",[])}e.run(["$templateCache",function(e){e.put("app/watchlist/watchlist.directive.tpl.html",'<table><thead><tr><th>Fav</th><th>Issuer</th><th>Symbol</th><th>Size</th><th>Expiration</th><th>Bid</th><th>Bid YTM</th><th>Ask</th><th>Ask YTM</th></tr></thead><tbody><tr ng-repeat="bond in bonds track by bond.i + bond.s | filter:filter | orderBy:predicate:reverse"><td><bonds-favourite bond="bond"></bonds-favourite></td><td>{{bond.i}}</td><td>{{bond.s}}</td><td>{{bond.v}}</td><td><bonds-expire date="{{bond.e}}"></bonds-expire></td><td ng-click="setOrderTemplate(bond,\'b\')">{{bond.b}}</td><td>{{rb.YTMNowSymbol(bond.s,bond.b)|percentage}}</td><td ng-click="setOrderTemplate(bond,\'a\')">{{bond.a}}</td><td>{{rb.YTMNowSymbol(bond.s,bond.a)|percentage}}</td></tr></tbody></table>')}])}();